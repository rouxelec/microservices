version: 0.2

phases:
  pre_build:
    commands:
      - echo Logging in to Amazon ECR...
      - aws --version
      - ALB_URL=$(aws ssm get-parameter --name "alb_url" | jq -r '.Parameter.Value')
      - QUERY_STRING="?target=ecs"
      - ECS_URL="$ALB_URL$QUERY_STRING"
      - echo $ECS_URL
      - USER_ID="ecs"
  build:
    commands:
      - echo Test started on `date`
      - pwd
      - chmod 777 src/codebuild/test.sh
      - src/codebuild/test.sh $ECS_URL $USER_ID 
  post_build:
    commands:
      - echo Test completed on `date`